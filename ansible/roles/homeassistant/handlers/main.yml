- name: Restart mosquitto
  community.docker.docker_container:
    name: mosquitto
    state: started
    restart: true

- name: Generate mosquitto password
  community.docker.docker_container_exec:
    container: mosquitto
    argv:
      - mosquitto_passwd
      - -b
      - -c
      - /mosquitto/config/mosquitto.passwd
      - "{{ mosquitto_user }}"
      - "{{ mosquitto_password }}"
    user: "{{ docker_user.id }}"
  notify: Restart mosquitto

- name: Restart Docker
  ansible.builtin.systemd:
    name: docker
    state: restarted
  become: true

- name: Restart NetworkManager
  ansible.builtin.systemd:
    name: NetworkManager
    state: restarted
  become: true
